# 一、Unicode字符集的产生

[所有Unicode字符](https://unicode-table.com/cn/)

`ASCII、GB2312、GBK、Shift_Jis、ISO/IEC 8859` 等地区编码都是各个国家为了自己的语言文化开发的，不具有通用性，在一种编码下开发的软件或者编写的文档，拿到另一种编码下就会失效，必须提前使用程序转码，非常麻烦。  
人们迫切希望有一种编码能够统一世界各地的字符，计算机只要安装了这一种字编码，就能支持使用世界上所有的文字，再也不会出现乱码，再也不需要转码了，这对计算机的数据传递来说是多么的方便呀！  

就在这种呼吁下，Unicode 诞生了。Unicode 也称为统一码、万国码；看名字就知道，Unicode 希望统一所有国家的字符编码。  
- Unicode 于 1994 年正式公布第一个版本，现在的规模可以容纳 100 多万个符号，是一个很大的集合。
- Windows、Linux、Mac OS 等常见操作系统都已经从底层（内核层面）开始支持 Unicode，大部分的网页和软件也使用 Unicode，Unicode 是大势所趋。  
  
不过由于历史原因，<mark class="hltr-red">目前的计算机仍然安装了 ASCII 编码以及 GB2312、GBK、Big5、Shift-JIS 等地区编码，以支持不使用 Unicode 的软件或者文档</mark>。内核在处理字符时，一般会将地区编码先转换为 Unicode，再进行下一步处理。

<mark class="hltr-red">对于常用的字符，它的 Unicode 编号范围是 0 ~ FFFF，用 1~3 个字节足以存储，只有及其罕见，或者只有少数地区使用的字符才需要 4~6个字节存储。</mark>

<br/>

# 二、Unicode字符集的编码方案
[[「001」字符集与字符编码相关知识基础概念#^899c6f |「字符集与字符编码的区别」]]
> Unicode 是一套字符集，而不是一套字符编码


Unicode 可以使用的编码方案有三种，分别是：
- UTF-8：一种变长的编码方案，使用 1~6 个字节来存储；
- UTF-32：一种固定长度的编码方案，不管字符编号大小，始终使用 4 个字节来存储；
- UTF-16：介于 UTF-8 和 UTF-32 之间，使用 2 个或者 4 个字节来存储，长度既固定又可变。
UTF 是 `Unicode Transformation Format` 的缩写，意思是“Unicode转换格式”，后面的数字表明至少使用多少个比特位（Bit）来存储字符。

<br/>

## 2.1 UTF-8
UTF-8 的编码规则很简单：
- 如果只有一个字节，那么最高的比特位为 0，这样可以兼容 ASCII；
- 如果有多个字节，那么第一个字节从最高位开始，连续有几个比特位的值为 1，就使用几个字节编码，剩下的字节均以 10 开头。
- 具体的表现形式为：
	- 0xxxxxxx：单字节编码形式，这和 ASCII 编码完全一样，因此 UTF-8 是兼容 ASCII 的；
	- 110xxxxx 10xxxxxx：双字节编码形式（第一个字节有两个连续的 1）；
	- 1110xxxx 10xxxxxx 10xxxxxx：三字节编码形式（第一个字节有三个连续的 1）；
	- 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx：四字节编码形式（第一个字节有四个连续的 1）。

| 字符     | Unicode编号       | UTF-8编码   | 编码长度 |
| -------- | ----------------- | ---------- | -------- |
| 字母`N`  | 01001110          | 0<font color="#7030a0">1001110</font>  | 1Bytes   |
| 符号`æ`  | 11100110          | 11000<font color="#7030a0">011</font> 10<font color="#7030a0">100110</font> | 2Bytes   |
| 中文`齐` | 00101110 11101100 | 11100<font color="#7030a0">010</font> 10<font color="#7030a0">111011</font> 10<font color="#7030a0">101100</font> | 3Bytes   |

<br/>

## 2.2 UTF-16
UFT-16 比较奇葩，它使用 2 个或者 4 个字节来存储。
- 对于 Unicode 编号范围在 `0 ~ FFFF` 之间的字符，UTF-16 使用两个字节存储，并且直接存储 Unicode 编号，不用进行编码转换，这跟 UTF-32 非常类似。
- 对于 Unicode 编号范围在 `10000~10FFFF` 之间的字符，UTF-16 使用四个字节存储，具体来说就是：将字符编号的所有比特位分成两部分，较高的一些比特位用一个值介于 `D800~DBFF` 之间的双字节存储，较低的一些比特位（剩下的比特位）用一个值介于 `DC00~DFFF` 之间的双字节存储。

| Unicode编号范围        | 具体的Unicode编号       | UTF-16编码                          | 编码长度 |
| ---------------------- | ----------------------- | ----------------------------------- | -------- |
| 0000 0000 ~ 0000 FFFF  | xxxxxxxx xxxxxxxx       | xxxxxxxx xxxxxxxx                   | 2Bytes   |
| 0001 0000 ～ 0010 FFFF | yy yyyyyyyy xx xxxxxxxx | 110110yy yyyyyyyy 110111xx xxxxxxxx | 4Bytes   | 

位于 D800~0xDFFF 之间的 Unicode 编码是特别为四字节的 UTF-16 编码预留的，所以不应该在这个范围内指定任何字符。如果你真的去查看 Unicode 字符集，会发现这个区间内确实没有收录任何字符。  
UTF-16 要求在制定 Unicode 字符集时必须考虑到编码问题，所以真正的 Unicode 字符集也不是随意编排字符的。
<br/>

## 2.3 UTF-32
UTF-32 是固定长度的编码，始终占用 4 个字节，足以容纳所有的 Unicode 字符，所以直接存储 Unicode 编号即可，不需要任何编码转换。浪费了空间，提高了效率。
<br/>

## 2.4 Unicode的3种编码方案对比
首先，只有 UTF-8 兼容 ASCII，UTF-32 和 UTF-16 都不兼容 ASCII，因为它们没有单字节编码。

### 2.4.1 UTF-8
优点：
	- UTF-8 使用尽量少的字节来存储一个字符，不但能够节省存储空间，而且在网络传输时也能节省流量，所以很多纯文本类型的文件（例如各种编程语言的源文件、各种日志文件和配置文件等）以及绝大多数的网页（例如百度、新浪、163等）都采用 UTF-8 编码。 
	- UTF-8 兼容 ASCII
缺点：
	- UTF-8 的缺点是效率低，不但在存储和读取时都要经过转换，
	- 处理字符串时也非常麻烦。例如，要在一个 UTF-8 编码的字符串中找到第 10 个字符，就得从头开始一个一个地检索字符，这是一个很耗时的过程，因为 UTF-8 编码的字符串中每个字符占用的字节数不一样，如果不从头遍历每个字符，就不知道第 10 个字符位于第几个字节处，就无法定位。（<mark class="hltr-blue">随着算法的逐年精进，UTF-8 字符串的定位效率也越来越高了，往往不再是槽点了。</mark>）

### 2.4.3 UTF-16
UTF-16 可以看做是 UTF-8 和 UTF-32 的折中方案，它平衡了存储空间和处理效率的矛盾。对于常用的字符，用两个字节存储足以，这个时候 UTF-16 是不需要转换的，直接存储字符的编码值即可。  Windows 内核、.NET Framework、Cocoa、Java String 内部采用的都是 UTF-16 编码。UTF-16 是幕后的功臣，我们在编辑源代码和文档时都是站在前台，所以一般感受不到，其实很多文本在后台处理时都已经转换成了 UTF-16 编码。不过，UNIX 家族的操作系统（Linux、Mac OS、iOS 等）内核都采用 UTF-8 编码

### 2.4.3 UTF-32
优点：
	- UTF-32 是“以空间换效率”，正好弥补了 UTF-8 的缺点，UTF-32 的优势就是效率高，在存储和读取字符时不需要任何转换。
	- 处理字符串时也能最快速地定位字符。例如，在一个 UTF-32 编码的字符串中查找第 10 个字符，很容易计算出它位于第 37 个字节处，直接获取就行，不用再逐个遍历字符了，没有比这更快的定位字符的方法了。  
缺点：
	- UTF-32 的缺点也很明显，就是太占用存储空间了，在网络传输时也会消耗很多流量。我们平常使用的字符编码值一般都比较小，用一两个字节存储足以，用四个字节简直是暴殄天物，甚至说是不能容忍的，所以 UTF-32 在应用上不如 UTF-8 和 UTF-16 广泛。  

  
